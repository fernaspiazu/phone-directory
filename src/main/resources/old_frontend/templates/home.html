<!--
# =============================================================================
#
#   Copyright (c) 2014, fumandito@gmail.com
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#
# =============================================================================
-->
<!DOCTYPE html>
<html lang="en-GB" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:substituteby="fragments/head::head ('Home')"></head>
<body>

<div class="container">
  <div class="page-header">
    <h1>Telephone Directory</h1>
  </div>
  <p class="lead">Insert a name or a telephone number.</p>

  <table class="table table-bordered table-striped default-datatable">
    <thead>
      <tr>
        <th>First name</th>
        <th>Last name</th>
        <th>Telephone number</th>
        <th class="sorting_asc_disabled sorting_desc_disabled"></th>
      </tr>
    </thead>
    <tbody>
      <!-- Datatable server side fill this body -->
    </tbody>
  </table>

  <hr/>
  <div class="control-group pull-right">
    <div class="controls">
      <a id="newEntry" href="new-entry.html" th:href="@{/new-entry}" class="btn btn-primary">New Entry</a>
    </div>
  </div>
</div>

<div id="footer">
  <div class="footer-container">
    <p class="text-muted text-center">XPeppers test</p>
  </div>
</div>
<script type="text/javascript" th:inline="javascript">
  /*<![CDATA[*/
  $(document).ready(function () {
	  var $datatable = $(".default-datatable");

    $datatable.dataTable({
      "bProcessing" : true,
      "bServerSide" : true,
      "sAjaxSource" : /*[[${#httpServletRequest.getContextPath()+'/search'}]]*/ "/search",
      "sServerMethod" : "GET",
      "aaSorting": [],
      "aoColumns": [
        {"mData" : "firstName"},
        {"mData" : "lastName"},
        {"mData" : "phoneNumber"},
        {"mData" : "id", bSortable : false, sWidth : "30px"}
      ],
      "fnRowCallback" : function(nRow, aData, iDisplayIndex) {
        $(nRow).attr('id', aData['id']);
        $(nRow).find('td').last().css({'text-align' : 'center'}).html('')
          .append('<div onclick="details(this);" class="glyphicon glyphicon-share click-icon edit-user" title="Details"></div>');
      },
      "iDisplayLength": 10,
      "bLengthChange": true,
      "sDom": "<'row'<'col-xs-6'l><'col-xs-6'f>r>t<'row'<'col-xs-6'i><'col-xs-6'p>>",
      "sPaginationType": "bootstrap",
      "bInfo": true
    });

    $datatable.parent().find("input[type='text']").addClass("form-control input-sm").css({"width": 360});
    $datatable.parent().find("select").addClass("form-control input-sm");
  });

  function details(icon) {
    var url = /*[[${#httpServletRequest.getContextPath()+'/details'}]]*/ "/details";
    window.location = url + '?id=' + $(icon).closest('tr').attr('id');
  }
  /*]]>*/
</script>
</body>
</html>